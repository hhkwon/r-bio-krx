---
title: "BIO SECTOR OVERVIEW in KRX"
output: 
  flexdashboard::flex_dashboard:
    theme: lumen
    css: styles.css
runtime: shiny
---

```{r global, include=FALSE}
library(readxl)
library(tidyverse)
library(reshape2)
library(xts)
library(dygraphs)
library(plotly)
library(quantmod)
library(knitr)
library(kableExtra)
theme_set(theme_classic())

#OPTION
options(crayon.enabled = FALSE)
options(stringsAsFactors=FALSE)

# PLOSHING TICKERS IN MASTER 
MASTER <- read_excel('./DATA/RAW/MASTER.xlsx')
MASTER <- rename(MASTER, f_code = full_code)
MASTER <- data.frame(MASTER[,-1])

# PLOSHING TICKERS IN MASTER
NAVER_IDST <- read_excel('./DATA/RAW/NAVER_INDUSTRY.xlsx', sheet='STOCK')
NAVER_IDST <- data.frame(NAVER_IDST[-1])
NAVER_IDST <- rename(NAVER_IDST, s_code = X1)

# POLISHING INDEX
INDEX_ALL <- read.csv('./DATA/RAW/INDEX.csv')
colnames(INDEX_ALL) <- c('date', 'KOSDAQ', 'KOSPI')
INDEX_ALL[['date']] <- as.Date(INDEX_ALL[['date']])
INDEX_ALL <- arrange(INDEX_ALL, date)

# PLOSHING KRX_DATA
KRX_DATA_ALL <- read.csv('./DATA/RAW/KRX_DATA_ALL.csv')
KRX_DATA_ALL <- rename(KRX_DATA_ALL, f_code = ticker)
KRX_DATA_ALL <- left_join(KRX_DATA_ALL, MASTER, by = "f_code")
KRX_DATA_ALL <- rename(KRX_DATA_ALL, s_code = short_code)
KRX_DATA_ALL <- left_join(KRX_DATA_ALL, NAVER_IDST, by = "s_code")
KRX_DATA_ALL <- rename(KRX_DATA_ALL, sector = X2)
KRX_DATA_ALL <- rename(KRX_DATA_ALL, name = codeName)
KRX_DATA_ALL[,"X0"] <- NULL
KRX_DATA_ALL <- filter(KRX_DATA_ALL, vol_s!=0)
KRX_DATA_ALL <- rename(KRX_DATA_ALL, date = X)
KRX_DATA_ALL[,'date'] <- as.Date(KRX_DATA_ALL[,'date'])
KRX_DATA_ALL[,'cap_mil'] <- KRX_DATA_ALL[,'cap_mil'] * 1000000

# PICK BIO FROM KRX_DATA
KRX_DATA_BIO <- filter(KRX_DATA_ALL, sector == "제약" | sector == "생물공학")

# SPLIT BY NAME
KRX_DATA_BIO_bycode <- split(KRX_DATA_BIO, KRX_DATA_BIO[,'name'])


# -- PAGE 1 TOP -- #

# Total cap_mil
sum_cap_mil_last <-sum(sapply(KRX_DATA_BIO_bycode, function(x){
  x[1,][,c('cap_mil')]
}))/10000000
sum_cap_mil_last_text <- format(sum_cap_mil_last,big.mark=",",scientific=FALSE)

# Total vol_m
sum_vol_m_last <-sum(sapply(KRX_DATA_BIO_bycode, function(x){
  x[1,][,c('vol_m')]
}))/1000000
sum_vol_m_last_text <- format(sum_vol_m_last,big.mark=",",scientific=FALSE)

# Total vol_m / cap_mil
cap_vol <- (sum_vol_m_last/sum_cap_mil_last)*100
cap_vol <- round(cap_vol, digits = 2)
cap_vol_text <- paste0(cap_vol,'%')

# Total count
total_count <- length(KRX_DATA_BIO_bycode)


# -- PAGE 1 MID LEFT -- # 

# KOSPI, KOSDAQ NMLZTION
INDEX_ALL_NML<-data.frame(date=INDEX_ALL[["date"]])
INDEX_ALL_NML[["KOSDAQ"]] <- INDEX_ALL[["KOSDAQ"]]/INDEX_ALL[["KOSDAQ"]][[1]]
INDEX_ALL_NML[["KOSPI"]] <- INDEX_ALL[["KOSPI"]]/INDEX_ALL[["KOSPI"]][[1]]
INDEX_ALL_NML <- xts(INDEX_ALL_NML[,-1], order.by = INDEX_ALL_NML[,1])

# BIO Cap NMLZTION
KRX_DATA_BIO_cap_term <- data.frame(group_by(KRX_DATA_BIO, date) %>% summarise(sum(cap_mil))) %>% filter(date >= '2017-11-01' & date <= '2018-03-30')
KRX_DATA_BIO_cap_term <- rename(KRX_DATA_BIO_cap_term, KRX_BIO=sum.cap_mil.)
KRX_DATA_BIO_cap_term_NML <- mutate(KRX_DATA_BIO_cap_term, KRX_BIO.N = KRX_DATA_BIO_cap_term[['KRX_BIO']]/KRX_DATA_BIO_cap_term[['KRX_BIO']][[1]])[,c(1,3)]
KRX_DATA_BIO_cap_term <- xts(KRX_DATA_BIO_cap_term[,-1], order.by = KRX_DATA_BIO_cap_term[,1])
KRX_DATA_BIO_cap_term_NML <- xts(KRX_DATA_BIO_cap_term_NML[,-1], order.by = KRX_DATA_BIO_cap_term_NML[,1])
names(KRX_DATA_BIO_cap_term) <- 'KRX_BIO'
names(KRX_DATA_BIO_cap_term_NML) <- 'KRX_BIO.n'

# MERGE
MERGE.INDEX_BIO <- merge(INDEX_ALL_NML, KRX_DATA_BIO_cap_term_NML)-1

BIO_Market_CAP_and_KRX_chart <-  dygraph(MERGE.INDEX_BIO) %>%
    dyOptions(colors = RColorBrewer::brewer.pal(3, "BuGn")) %>%
    dyOptions(fillGraph = TRUE, fillAlpha = 0.35) %>%
    dyAxis("x", drawGrid = FALSE) %>%
    dyAxis("y", label = "Cumulative Return (Point)", axisLineColor="white",drawGrid = FALSE, axisLabelFormatter = 'function(d){ return d.toFixed(2)  }') %>%
    dySeries('KOSDAQ', label = "코스닥", strokeWidth = 1) %>%
    dySeries('KOSPI', label = "코스피", strokeWidth = 1, drawPoints = FALSE, pointSize = 2) %>%
    dySeries('KRX_BIO.n', label = "바이오", strokeWidth = 1)


# -- PAGE 1 MID RIGHT -- #

# biggest Cap_mil
cap_mil_lastday <- data.frame(group_by(KRX_DATA_BIO, name) %>% summarise(M.CAP = cap_mil[[1]], TRD.VOL = vol_m[[1]], TV_MK = vol_m[[1]]/cap_mil[[1]]))
cap_mil_lastday['M.CAP'] <- round(cap_mil_lastday['M.CAP'] / 1000000000, digits=0)
cap_mil_lastday['TRD.VOL'] <- round(cap_mil_lastday['TRD.VOL'] / 1000000, digits=0)
cap_mil_lastday['TV_MK'] <- round(cap_mil_lastday['TV_MK']*100, digits = 2)
cap_mil_lastday <- arrange(cap_mil_lastday, -M.CAP)
cap_mil_lastday['M.CAP'] <- format(cap_mil_lastday['M.CAP'], nsmall=0)
cap_mil_lastday['TRD.VOL'] <- format(cap_mil_lastday['TRD.VOL'], nsmall=0)
cap_mil_lastday <- rename(cap_mil_lastday, NAME=name)

kable(cap_mil_lastday[c(1:10),], align=c('l','c','c','c')) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T)

# -- PAGE 1 BOTTOM LEFT -- #
top7_cap <- (KRX_DATA_BIO %>% group_by(name) %>% summarise(mean_cap = mean(cap_mil)) )
top7_cap <- arrange(top7_cap, -mean_cap)
top7_cap <- as.data.frame(top7_cap)
top7_cap <- top7_cap[[1]][1:7]

term_chart <- function(arg.){
  k_bio_term <- filter(KRX_DATA_BIO, date >= '2017-11-01' & date <= '2018-03-30')
  k <- split(filter(k_bio_term, name %in% top7_cap), filter(k_bio_term, name %in% top7_cap)[,"name"])
  k_xts <- lapply(k,function(x){
    xts(x[c('date',arg.)][,-1], order.by = x[c('date',arg.)][,1])
  })
  k_bind <- do.call(cbind,k_xts)
  return(k_bind)
}

page_1_bt_left <-  dygraph(term_chart('vol_m')/1000000) %>%
    dyOptions(colors = RColorBrewer::brewer.pal(7, "GnBu")) %>%
    dyOptions(fillGraph = TRUE, fillAlpha = 0.5) %>%
    dyAxis("x", drawGrid = FALSE) %>%
    dyAxis("y", axisLineColor="white",drawGrid = FALSE, axisLabelFormatter = 'function(d){ return d.toFixed(0)  }') %>%
    dyLegend(width = 500)



# -- PAGE 1 BOTTOM RIGHT -- #

# Average Trading Volume Trend
KRX_BIO_Avr.VOL <- data.frame(group_by(KRX_DATA_BIO, date) %>% summarise(Avr.VOL = mean(vol_m)/1000000))
KRX_BIO_Avr.VOL['Avr.VOL'] <- round(KRX_BIO_Avr.VOL['Avr.VOL'], digits=0)
KRX_BIO_Avr.VOL <- xts(KRX_BIO_Avr.VOL[,-1], order.by = KRX_BIO_Avr.VOL[,1])
KRX_BIO_Avr.VOL_byWeek_title <- list()
KRX_BIO_Avr.VOL_byWeek_title <- unlist(as.Date(sapply(split(KRX_BIO_Avr.VOL, 'weeks'), function(x){
  index(x)[[1]]
})))
KRX_BIO_Avr.VOL_byWeek_mean <- list()
KRX_BIO_Avr.VOL_byWeek_mean <- unlist(sapply(split(KRX_BIO_Avr.VOL, 'weeks'), function(x){
  mean(x)
}))
KRX_BIO_Avr.VOL_byWeek <- data.frame(date = KRX_BIO_Avr.VOL_byWeek_title, Avr.VOL = KRX_BIO_Avr.VOL_byWeek_mean)

# Average Market Cap Trend 
KRX_BIO_M.CAP <- data.frame(group_by(KRX_DATA_BIO, date) %>% summarise(M.CAP = mean(cap_mil)/100000000))
KRX_BIO_M.CAP['M.CAP'] <- round(KRX_BIO_M.CAP['M.CAP'], digits=0)
KRX_BIO_M.CAP <- xts(KRX_BIO_M.CAP[,-1], order.by = KRX_BIO_M.CAP[,1])

KRX_BIO_M.CAP_byWeek_title <- list()
KRX_BIO_M.CAP_byWeek_title <- unlist(as.Date(sapply(split(KRX_BIO_M.CAP, 'weeks'), function(x){
  index(x)[[1]]
})))

KRX_BIO_M.CAP_byWeek_mean <- list()
KRX_BIO_M.CAP_byWeek_mean <- unlist(sapply(split(KRX_BIO_M.CAP, 'weeks'), function(x){
  mean(x)
}))

KRX_BIO_M.CAP_byWeek <- data.frame(date = KRX_BIO_M.CAP_byWeek_title, M.CAP = KRX_BIO_M.CAP_byWeek_mean)
KRX_BIO_Avr.VOL_M.CAP_byWeek <- left_join(KRX_BIO_Avr.VOL_byWeek, KRX_BIO_M.CAP_byWeek)

Trading_Volume_and_Market_CAP <- ggplotly(
ggplot(KRX_BIO_Avr.VOL_M.CAP_byWeek, aes(x=date, y=Avr.VOL)) +
  geom_bar(stat="identity", fill="#1ab394", alpha=0.4) +
  labs(title="Trading Volume(Aver.) & M.Cap Trend", 
       subtitle="Average Trading Volume of BIO Sector in KRX MARKET", 
       caption="Source: EBEST API & WEB DATA CRAWLING") +
  theme(axis.title.x=element_blank(), axis.title.y=element_blank()) +
  scale_x_date(date_labels = "%Y%m%d") +
  geom_line(aes(x=date, y=M.CAP),stat="identity", size=1, linetype = "twodash", color="skyblue", position = 'jitter') +
  scale_y_continuous(sec.axis = sec_axis(~.))
)

# -- PAGE 1 BOTTOM RIGHT - 2 -- #

#ATR & WPR FUNCTION
KRX_DATA_BIO_ATR_WPR_bycode <- list()
for ( i in cap_mil_lastday[,'NAME'][1:10]){
  KRX_DATA_BIO_ATR_WPR_bycode[[ i ]] <- filter( KRX_DATA_BIO, name == i ) %>% arrange(date)
  KRX_DATA_BIO_ATR_WPR_bycode[[ i ]] <- mutate( KRX_DATA_BIO_ATR_WPR_bycode[[ i ]], ATR = ATR( KRX_DATA_BIO_ATR_WPR_bycode[[ i ]][,c("high","low","close")] , n=3)[,c('atr')])
  KRX_DATA_BIO_ATR_WPR_bycode[[ i ]] <- mutate( KRX_DATA_BIO_ATR_WPR_bycode[[ i ]], A.Ratio = (KRX_DATA_BIO_ATR_WPR_bycode[[ i ]][[ 'ATR' ]] / KRX_DATA_BIO_ATR_WPR_bycode[[ i ]][[ "close" ]]) )
  KRX_DATA_BIO_ATR_WPR_bycode[[ i ]] <- mutate( KRX_DATA_BIO_ATR_WPR_bycode[[ i ]], WPR = WPR( KRX_DATA_BIO_ATR_WPR_bycode[[ i ]][,c("high","low","close")] , n=5))
}

KRX_DATA_BIO_ATR_WPR_bycode_lastday <- do.call(rbind,lapply(KRX_DATA_BIO_ATR_WPR_bycode, function(x){
  x[nrow(x),]
}))
rownames(KRX_DATA_BIO_ATR_WPR_bycode_lastday) <- NULL
KRX_DATA_BIO_ATR_WPR_bycode_lastday <- KRX_DATA_BIO_ATR_WPR_bycode_lastday[c('name','close','sector','ATR','A.Ratio','WPR')]
KRX_DATA_BIO_ATR_WPR_bycode_lastday['ATR'] <- round(KRX_DATA_BIO_ATR_WPR_bycode_lastday['ATR'], digits=0)
KRX_DATA_BIO_ATR_WPR_bycode_lastday['A.Ratio'] <- sapply(round(KRX_DATA_BIO_ATR_WPR_bycode_lastday['A.Ratio']*100, digits=2), function(x){
  paste0(x,'%')
})
KRX_DATA_BIO_ATR_WPR_bycode_lastday['WPR'] <- round(KRX_DATA_BIO_ATR_WPR_bycode_lastday['WPR'], digits=2)
KRX_DATA_BIO_ATR_WPR_bycode_lastday <- KRX_DATA_BIO_ATR_WPR_bycode_lastday[,c(1,3,2,4,5,6)]

kable(KRX_DATA_BIO_ATR_WPR_bycode_lastday, align=c('l','l','c','c','c','c')) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T)

# dygraph(term_chart('close'))
# dygraph(term_chart('vol_m'))
# dygraph(term_chart('vol_s'))
# dygraph(term_chart('cap_mil'))

# 
# #STOCK PRICE CHART
# k <- KRX_DATA_BIO_bycode[[1]][,c(1:9)]
# k_xts <- xts(k[,-1], order.by = k[,1])[,1] 
# 
# KRX_DATA_BIO_bycode[1]


# # -- PAGE 1 BOTOOM RIGHT -- #
# 
# kable(dt) %>%
#   kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T)
# 
# head(KRX_DATA_BIO)
# kable_styling(a, bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T)



# ------ Page2 ------ #

# Mar_CAP & Graph
page_2_m.c <- KRX_DATA_BIO_ATR_WPR_bycode[['셀트리온']][c('date','cap_mil')]
page_2_m.c['cap_mil'] <- page_2_m.c['cap_mil']/1000000
page_2_m.c_xts <- xts(page_2_m.c[,-1], order.by = page_2_m.c[,1])
names(page_2_m.c_xts) <- 'M.CAP'

page_2_m.cap_chart <- dygraph(split(page_2_m.c_xts, 'months')[[5]][1:5]) %>%
  dyLegend(show = "never") %>%
  dyAxis("x", drawGrid = FALSE, axisLineColor='#f2f2f2') %>%
  dyAxis("y", drawGrid = FALSE, axisLineColor='#f2f2f2') %>%
  dySeries('M.CAP', strokeWidth = 1, drawPoints = TRUE, pointSize = 3)

  #Last
  page_2_m.c_last <- format(page_2_m.c[['cap_mil']][nrow(page_2_m.c)], big.mark=",", scientific=FALSE)

  #MAX
  page_2_m.c_max <- format(max(page_2_m.c[['cap_mil']]), big.mark=",", scientific=FALSE)

  #ARV.
  page_2_m.c_avr <- format(mean(page_2_m.c[['cap_mil']]), big.mark=",", scientific=FALSE)
  
  #MIN
  page_2_m.c_min <- format(min(page_2_m.c[['cap_mil']]), big.mark=",", scientific=FALSE)
  
# Trading Volumes & Graph

page_2_t.v <- KRX_DATA_BIO_ATR_WPR_bycode[['셀트리온']][c('date','vol_m')]
page_2_t.v['vol_m'] <- page_2_t.v['vol_m']/1000000
page_2_t.v_xts <- xts(page_2_t.v[,-1], order.by = page_2_t.v[,1])
names(page_2_t.v_xts) <- 'T.VOL'

page_2_t.v_chart <- dygraph(split(page_2_t.v_xts, 'months')[[5]][1:5]) %>%
  dyLegend(show = "never") %>%
  dyAxis("x", drawGrid = FALSE, axisLineColor='#f2f2f2') %>%
  dyAxis("y", drawGrid = FALSE, axisLineColor='#f2f2f2') %>%
  dySeries('T.VOL', strokeWidth = 1, drawPoints = TRUE, pointSize = 3)

  #Last
  page_2_t.v_last <- format(page_2_t.v[['vol_m']][nrow(page_2_m.c)], big.mark=",", scientific=FALSE)

  #MAX
  page_2_t.v_max <- format(max(page_2_t.v[['vol_m']]), big.mark=",", scientific=FALSE)

  #ARV.
  page_2_t.v_avr <- format(mean(page_2_t.v[['vol_m']]), big.mark=",", scientific=FALSE)
  
  #MIN
  page_2_t.v_min <- format(min(page_2_t.v[['vol_m']]), big.mark=",", scientific=FALSE)


# ATR & WPR
page_2_ATR_WPR <- KRX_DATA_BIO_ATR_WPR_bycode[['셀트리온']][c('ATR','WPR')]
page_2_ATR_WPR_top <- page_2_ATR_WPR[nrow(page_2_ATR_WPR),]

# page_2_ATR_WPR_kable <- kable(page_2_ATR_WPR_top, align=c('l','l')) %>%
#   kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T) %>%
#   row_spec(0, background = "#f2f2f2") %>%
#   row_spec(1, background = "#f2f2f2")

page_2_ATR_WPR_max <- format(c(round(max(page_2_ATR_WPR[,'ATR'], na.rm = TRUE), digits=0), max(page_2_ATR_WPR[,'WPR'], na.rm = TRUE)), nsmall = 2)

page_2_ATR_WPR_avr <- format(c(round(mean(page_2_ATR_WPR[,'ATR'], na.rm = TRUE), digits=0), round(mean(page_2_ATR_WPR[,'WPR'], na.rm = TRUE),digits=2)), nsmall=2)

page_2_ATR_WPR_min <- format(c(round(min(page_2_ATR_WPR[,'ATR'], na.rm = TRUE), digits=0), round(min(page_2_ATR_WPR[,'WPR'], na.rm = TRUE), digits=0)), nsmall=2)

# Price & TV Chart
p_tv_chart <- KRX_DATA_BIO_ATR_WPR_bycode[['셀트리온']][c('date','close','vol_m')]
p_tv_chart['vol_m'] <- p_tv_chart['vol_m']/1000000
p_tv_chart_xts <- xts(p_tv_chart[,-1], order.by = p_tv_chart[,1])

page_2_p_tv_chart <- dygraph(p_tv_chart_xts) %>%
  dyOptions(colors = RColorBrewer::brewer.pal(4, "GnBu")) %>%
  dyLegend(show = "never") %>%
  dyOptions(fillGraph = TRUE, fillAlpha = 0.3) %>%
  dyAxis("x", drawGrid = FALSE, axisLineColor='#f2f2f2') %>%
  dyAxis("y", drawGrid = FALSE, axisLineColor='#f2f2f2', axisLabelFormatter = 'function(d){ return d }') %>%
  dySeries('close', label = "종가", strokeWidth = 1) %>%
  dySeries('vol_m', label = "거래대금", strokeWidth = 1)

# TOTAL KABLE
Total_Kable <- KRX_DATA_BIO_ATR_WPR_bycode[['셀트리온']]
Total_Kable <- Total_Kable[c('date','name','change','close','open','high','low','vol_s','ATR','A.Ratio','WPR','sector','marketName')]
Total_Kable['ATR'] <- round(Total_Kable['ATR'],digits=0)
Total_Kable['A.Ratio'] <- round(Total_Kable['A.Ratio'],digits=2)
Total_Kable['WPR'] <- round(Total_Kable['WPR'],digits=2)
Total_Kable <- arrange(Total_Kable, desc(date))
names(Total_Kable) <- c('DATE','NAME','CHANGE','CLOSE','OPEN','HIGH','LOW','VOL_S','ATR','A.RATIO','WPR','SECTOR','MARKET')
Total_Kable_render <- kable(Total_Kable[c(1:30),], align='c') %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T)

```


OVERVIEW {data-orientation=rows}
===================================== 

Column {.sidebar}
-----------------------------------------------------------------------
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
<div class="page_2_sidemenu">
  <div class="icons">
  <i class="fas fa-prescription-bottle-alt"></i><i class="fas fa-bong"></i><i class="fas fa-pills"></i>
  </div>
  <div class="page_2_sidemenu_title">
Biotechnology is the broad area of science involving living systems and organisms to develop or make products.
  </div>
  <div class="page_2_sidemenu_content">
The wide concept of "biotech" or "biotechnology" encompasses a wide range of procedures for modifying living organisms according to human purposes, going back to domestication of animals, cultivation of the plants, and "improvements" to these through breeding programs that employ artificial selection and hybridization.
  </div>
  <div class="page_2_sidemenu_content">
Pharmacogenomics (a combination of pharmacology and genomics) is the technology that analyses how genetic makeup affects an individual's response to drugs.[18] It deals with the influence of genetic variation on drug responses in patients by correlating gene expression or single-nucleotide polymorphisms with a drug's efficacy or toxicity.
  </div>
</div>

Row {data-height=140}
-------------------------------------



### Market Capitalization {data-height=140, class='of_hidden'}
<span class="label_1 bg_green fc_white">Daily</span>
<div class="top_c_1">
```{r}
renderText(sum_cap_mil_last_text)
```
  <p class="sub_c_1">Total MK (18/04/30)</p>
  <span class= "sub_per_1 fc_green">
    32%
    <i class="fa fa-bolt fa_1"></i>
  </span>
</div>



### Trading Volume {data-height=140, class='of_hidden'}
<span class="label_1 bg_green fc_white">Daily</span>
<div class="top_c_1">
```{r}
renderText(sum_vol_m_last_text)
```
  <p class="sub_c_1">Total TV (18/04/30)</p>
  <span class= "sub_per_1 fc_green">
    21%
    <i class="fas fa-level-up-alt fa_1"></i>
  </span>
</div>

    
### MC/TV Ratio {data-height=140, class='of_hidden'}
<span class="label_1 bg_amer fc_white">Monthly</span>
<div class="top_c_1">
```{r}
renderText(cap_vol_text)
```
  <p class="sub_c_1">MC per TV</p>
  <span class= "sub_per_1 fc_amer">
    16%
    <i class="fas fa-level-up-alt fa_1"></i>
  </span>
</div>


### Total Count {data-height=140, class='of_hidden'}
<span class="label_1 bg_skyblue fc_white">Quarterly</span>
<div class="top_c_1">
```{r}
renderText(total_count)
```
  <p class="sub_c_1">All Bio stocks</p>
  <span class= "sub_per_1 fc_skyblue">
    10%
    <i class="fas fa-level-down-alt fa_1"></i>
  </span>
</div>




Row
-------------------------------------

### BIO Market CAP and KRX chart {data-width=75%}

```{r}
BIO_Market_CAP_and_KRX_chart
```


### TOP TIER  {data-width=25%, class='of_hidden'}
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> NAME </th>
   <th style="text-align:center;"> M.CAP </th>
   <th style="text-align:center;"> TRD.VOL </th>
   <th style="text-align:center;"> TV_MK </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 셀트리온 <i class="fas fa-caret-up fa_mid_1 fc_red"></i></td>
   <td style="text-align:center;"> 33904 </td>
   <td style="text-align:center;"> 281759 </td>
   <td style="text-align:center;"> 0.83 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 삼성바이오로직스 <i class="fas fa-caret-up fa_mid_1 fc_red"></i></td>
   <td style="text-align:center;"> 32289 </td>
   <td style="text-align:center;"> 115669 </td>
   <td style="text-align:center;"> 0.36 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 셀트리온헬스케어 <i class="fas fa-caret-up fa_mid_1 fc_red"></i></td>
   <td style="text-align:center;"> 12596 </td>
   <td style="text-align:center;"> 81590 </td>
   <td style="text-align:center;"> 0.65 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 신라젠 <i class="fas fa-caret-up fa_mid_1 fc_red"></i></td>
   <td style="text-align:center;"> 5835 </td>
   <td style="text-align:center;"> 137089 </td>
   <td style="text-align:center;"> 2.35 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 한미약품 <i class="fas fa-caret-down fa_mid_1 fc_skyblue"></i></td>
   <td style="text-align:center;"> 5306 </td>
   <td style="text-align:center;"> 21352 </td>
   <td style="text-align:center;"> 0.40 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 한미사이언스 <i class="fas fa-caret-up fa_mid_1 fc_red"></i></td>
   <td style="text-align:center;"> 4940 </td>
   <td style="text-align:center;"> 6468 </td>
   <td style="text-align:center;"> 0.13 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 메디톡스 <i class="fas fa-caret-up fa_mid_1 fc_red"></i></td>
   <td style="text-align:center;"> 3946 </td>
   <td style="text-align:center;"> 17520 </td>
   <td style="text-align:center;"> 0.44 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 바이로메드 <i class="fas fa-caret-up fa_mid_1 fc_red"></i></td>
   <td style="text-align:center;"> 3455 </td>
   <td style="text-align:center;"> 30133 </td>
   <td style="text-align:center;"> 0.87 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 셀트리온제약 <i class="fas fa-caret-down fa_mid_1 fc_skyblue"></i></td>
   <td style="text-align:center;"> 2958 </td>
   <td style="text-align:center;"> 33392 </td>
   <td style="text-align:center;"> 1.13 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 유한양행 <i class="fas fa-caret-down fa_mid_1 fc_skyblue"></i></td>
   <td style="text-align:center;"> 2796 </td>
   <td style="text-align:center;"> 13471 </td>
   <td style="text-align:center;"> 0.48 </td>
  </tr>
</tbody>
</table>



Row
-------------------------------------
    
### 
    
```{r}
page_1_bt_left
```

### Trading Volume & Market CAP Trend (Aver.)
    
```{r}
Trading_Volume_and_Market_CAP
```
    
### TOP TIER INFO
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto; padding: 0px;">
<thead class="tableFloatingHeaderOriginal" style="position: static; margin-top: 0px; left: 1375px; z-index: 3; width: 511px; top: 627.156px;">
<tr>
<th style="text-align: left; min-width: 0px; max-width: none;">
name
</th>
<th style="text-align: left; min-width: 0px; max-width: none;">
sector
</th>
<th style="text-align: center; min-width: 0px; max-width: none;">
close
</th>
<th style="text-align: center; min-width: 0px; max-width: none;">
ATR
</th>
<th style="text-align: center; min-width: 0px; max-width: none;">
A.Ratio
</th>
<th style="text-align: center; min-width: 0px; max-width: none;">
WPR
</th>
</tr>
</thead><thead class="tableFloatingHeader" style="opacity: 0; display: none;">
<tr>
<th style="text-align:left;">
name
</th>
<th style="text-align:left;">
sector
</th>
<th style="text-align:center;">
close
</th>
<th style="text-align:center;">
ATR
</th>
<th style="text-align:center;">
A.Ratio
</th>
<th style="text-align:center;">
WPR
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
셀트리온 <span class="label_1_bt bg_yello fc_white">수급</span>
</td>
<td style="text-align:left;">
제약 <i class="fas fa-capsules fa_1_bt"></i>
</td>
<td style="text-align:center;">
271000
</td>
<td style="text-align:center;">
15150
</td>
<td style="text-align:center;">
5.59%
</td>
<td style="text-align:center;">
0.28
</td>
</tr>
<tr>
<td style="text-align:left;">
삼성바이오로직스 
</td>
<td style="text-align:left;">
제약 <i class="fas fa-capsules fa_1_bt"></i>
</td>
<td style="text-align:center;">
488000
</td>
<td style="text-align:center;">
22449
</td>
<td style="text-align:center;">
4.6%
</td>
<td style="text-align:center;">
0.34
</td>
</tr>
<tr>
<td style="text-align:left;">
셀트리온헬스케어
</td>
<td style="text-align:left;">
제약 <i class="fas fa-prescription-bottle-alt fa_1_bt"></i>
</td>
<td style="text-align:center;">
89800
</td>
<td style="text-align:center;">
4525
</td>
<td style="text-align:center;">
5.04%
</td>
<td style="text-align:center;">
0.30
</td>
</tr>
<tr>
<td style="text-align:left;">
신라젠 <span class="label_1_bt bg_pink fc_white">급등</span>
</td>
<td style="text-align:left;">
생물공학 <i class="fas fa-vial fa_1_bt"></i>
</td>
<td style="text-align:center;">
84100
</td>
<td style="text-align:center;">
5149
</td>
<td style="text-align:center;">
6.12%
</td>
<td style="text-align:center;">
0.55
</td>
</tr>
<tr>
<td style="text-align:left;">
한미약품 <span class="label_1_bt bg_pink fc_white">급등</span>
</td>
<td style="text-align:left;">
제약 <i class="fas fa-capsules fa_1_bt"></i>
</td>
<td style="text-align:center;">
466000
</td>
<td style="text-align:center;">
17688
</td>
<td style="text-align:center;">
3.8%
</td>
<td style="text-align:center;">
0.54
</td>
</tr>
<tr>
<td style="text-align:left;">
한미사이언스 <span class="label_1_bt bg_amer fc_white">안정</span>
</td>
<td style="text-align:left;">
제약 <i class="fas fa-prescription-bottle-alt fa_1_bt"></i>
</td>
<td style="text-align:center;">
77800
</td>
<td style="text-align:center;">
2743
</td>
<td style="text-align:center;">
3.53%
</td>
<td style="text-align:center;">
0.93
</td>
</tr>
<tr>
<td style="text-align:left;">
메디톡스 
</td>
<td style="text-align:left;">
생물공학 <i class="fas fa-prescription fa_1_bt"></i>
</td>
<td style="text-align:center;">
697600
</td>
<td style="text-align:center;">
27363
</td>
<td style="text-align:center;">
3.92%
</td>
<td style="text-align:center;">
0.17
</td>
</tr>
<tr>
<td style="text-align:left;">
바이로메드
</td>
<td style="text-align:left;">
생물공학 <i class="fas fa-vial fa_1_bt"></i>
</td>
<td style="text-align:center;">
216500
</td>
<td style="text-align:center;">
8271
</td>
<td style="text-align:center;">
3.82%
</td>
<td style="text-align:center;">
0.35
</td>
</tr>
<tr>
<td style="text-align:left;">
셀트리온제약 <span class="label_1_bt bg_yello fc_white">수급</span>
</td>
<td style="text-align:left;">
제약 <i class="fas fa-capsules fa_1_bt"></i>
</td>
<td style="text-align:center;">
86900
</td>
<td style="text-align:center;">
4977
</td>
<td style="text-align:center;">
5.73%
</td>
<td style="text-align:center;">
0.74
</td>
</tr>
<tr>
<td style="text-align:left;">
유한양행
</td>
<td style="text-align:left;">
제약 <i class="fas fa-capsules fa_1_bt"></i>
</td>
<td style="text-align:center;">
229000
</td>
<td style="text-align:center;">
8440
</td>
<td style="text-align:center;">
3.69%
</td>
<td style="text-align:center;">
0.73
</td>
</tr>
</tbody>
</table>


DETAILS {data-orientation=rows}
===================================== 

Column {.sidebar}
-----------------------------------------------------------------------

<div class="page_2_sidemenu">
  <img src="./img/ci_celltrion.png">
  <div class="page_2_sidemenu_title">
Celltrion, the new pioneer of the global biologics market has been contributing to the history of biosimilars.
  </div>
  <div class="page_2_sidemenu_content">
Celltrion is a global biologics leading company having its main business as biosimilar, novel biologics, and CMO. Celltrion bravely took the first step forward in developing an antibody biosimilar, when everyone else in the field thought it was impossible during the period when the term biosimilar itself was unfamiliar.
  </div>
  <div class="page_2_sidemenu_content">
Celltrion succeeded in obtaining a license for the novel biologics in 2012 for the first time in the world. Celltrion went on to achieve a remarkable feat of entering into the global market for the first time in the nation with its unquenchable innovative spirit, creativity, and keen insight that is ahead of our time. Naturally, Celltrion has become the leading biologics company in the Korean biologics industry as the pioneer of the biotechnology industry.
  </div>
</div>

```{r}
# selectInput("n_breaks", label = "Number of bins:",
#             choices = c(10, 20, 35, 50), selected = 20)
# 
# sliderInput("bw_adjust", label = "Bandwidth adjustment:",
#             min = 0.2, max = 2, value = 1, step = 0.2)
```


Row {data-height=130px, class='page_2_top_wrap'}
-------------------------------------

### {class=''}
<div class="page_2_top_title"><i class="fas fa-caret-down page_2_fa_top_1 fc_green"></i>
```{r}
renderText(page_2_m.c_last)
```
<span class="page_2_top_title_sub">Market capitalization (18/04/30)</span>
</div>

###
<div class="page_2_top_title"><i class="fas fa-caret-up page_2_fa_top_2 fc_red"></i>
```{r}
renderText(page_2_t.v_last)
```
<span class="page_2_top_title_sub">Trading Volume (18/04/30)</span>
</div>

###
<div class ='page_2_top_atr'><span class="page_2_label_1 bg_green fc_white">GAZUA</span>
<span class="page_2_top_atr_sub">LAST ATR</span>
```{r}
renderText(page_2_ATR_WPR_top[[1]])
```
</div>

<div class ='page_2_top_wpr'>
<span class="page_2_top_wpr_sub">LAST WPR</span>
```{r}
renderText(page_2_ATR_WPR_top[[2]])
```
</div>
    
    

Row {data-height=120px, class='page_2_top_wrap'}
-------------------------------------
    
###
```{r}
page_2_m.cap_chart
```

###
```{r} 
page_2_t.v_chart
```

###
<div class ='page_2_midup_max'>
<span class="page_2_midup_title_sub">Max ATR during Term</span>
```{r}
renderText(page_2_ATR_WPR_max[1])
```
</div>

<div class ='page_2_midup_avr'>
<span class="page_2_midup_title_sub">Max WPR during Term</span>
```{r}
renderText(page_2_ATR_WPR_max[2])
```
</div>


Row {data-height=80px, class='page_2_top_wrap'}
-------------------------------------
    
### {class=''}

<div class ='page_2_mid_max'>
<span class="page_2_mid_title_sub">Max M.CAP during Term</span>
```{r}
renderText(page_2_m.c_max)
```
</div>

<div class ='page_2_mid_avr'>
<span class="page_2_mid_title_sub">Avr M.CAP during Term</span>
```{r}
renderText(page_2_m.c_avr)
```
</div>

<div class ='page_2_mid_min'>
<span class="page_2_mid_title_sub">Min M.CAP during Term</span>
```{r}
renderText(page_2_m.c_min)
```
</div>


###
<div class ='page_2_mid_max'>
<span class="page_2_mid_title_sub">Max T.VOL during Term</span>
```{r}
renderText(page_2_t.v_max)
```
</div>

<div class ='page_2_mid_avr'>
<span class="page_2_mid_title_sub">Avr T.VOL during Term</span>
```{r}
renderText(page_2_t.v_avr)
```
</div>

<div class ='page_2_mid_min'>
<span class="page_2_mid_title_sub">Min T.VOL during Term</span>
```{r}
renderText(page_2_t.v_min)
```
</div>


###
<div class ='page_2_mid_atr'>
<span class="page_2_mid_title_sub">MIN ATR during Term</span>
```{r}
renderText(page_2_ATR_WPR_min[1])
```
</div>

<div class ='page_2_mid_wpr'>
<span class="page_2_mid_title_sub">MIN WPR during Term</span>
```{r}
renderText(page_2_ATR_WPR_min[2])
```
</div>




Row {class='page_2_chart_wrap'}
-------------------------------------
###
```{r}
page_2_p_tv_chart
```



Row {data-height=600px}
-------------------------------------
### HISTORICAL DATA
<div class="">
```{r}
Total_Kable_render
```
</div>

     
     
     
     